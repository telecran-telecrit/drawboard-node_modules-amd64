{"ast":null,"code":"import _slicedToArray from \"/home/pro/Solutions/drawboard-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/pro/Solutions/drawboard-light/src/components/ColorPicker.tsx\";\nimport React from \"react\";\nimport { Popover } from \"./Popover\";\nimport \"./ColorPicker.css\";\nimport { KEYS } from \"../keys\";\nimport { t } from \"../i18n\";\nimport { isWritableElement } from \"../utils\"; // This is a narrow reimplementation of the awesome react-color Twitter component\n// https://github.com/casesandberg/react-color/blob/master/src/components/twitter/Twitter.js\n// Unfortunately, we can't detect keyboard layout in the browser. So this will\n// only work well for QWERTY but not AZERTY or others...\n\nvar keyBindings = [[\"1\", \"2\", \"3\", \"4\", \"5\"], [\"q\", \"w\", \"e\", \"r\", \"t\"], [\"a\", \"s\", \"d\", \"f\", \"g\"]].flat();\n\nvar Picker = function Picker(_ref) {\n  var colors = _ref.colors,\n      color = _ref.color,\n      _onChange = _ref.onChange,\n      onClose = _ref.onClose,\n      label = _ref.label;\n  var firstItem = React.useRef();\n  var activeItem = React.useRef();\n  var gallery = React.useRef();\n  var colorInput = React.useRef();\n  React.useEffect(function () {\n    // After the component is first mounted\n    // focus on first input\n    if (activeItem.current) {\n      activeItem.current.focus();\n    } else if (colorInput.current) {\n      colorInput.current.focus();\n    }\n  }, []);\n\n  var handleKeyDown = function handleKeyDown(event) {\n    if (event.key === KEYS.TAB) {\n      var _document = document,\n          activeElement = _document.activeElement;\n\n      if (event.shiftKey) {\n        if (activeElement === firstItem.current) {\n          var _colorInput$current;\n\n          (_colorInput$current = colorInput.current) === null || _colorInput$current === void 0 ? void 0 : _colorInput$current.focus();\n          event.preventDefault();\n        }\n      } else {\n        if (activeElement === colorInput.current) {\n          var _firstItem$current;\n\n          (_firstItem$current = firstItem.current) === null || _firstItem$current === void 0 ? void 0 : _firstItem$current.focus();\n          event.preventDefault();\n        }\n      }\n    } else if (event.key === KEYS.ARROW_RIGHT || event.key === KEYS.ARROW_LEFT || event.key === KEYS.ARROW_UP || event.key === KEYS.ARROW_DOWN) {\n      var _document2 = document,\n          _activeElement = _document2.activeElement;\n      var index = Array.prototype.indexOf.call(gallery.current.children, _activeElement);\n\n      if (index !== -1) {\n        var length = gallery.current.children.length;\n        var nextIndex = event.key === KEYS.ARROW_RIGHT ? (index + 1) % length : event.key === KEYS.ARROW_LEFT ? (length + index - 1) % length : event.key === KEYS.ARROW_DOWN ? (index + 5) % length : event.key === KEYS.ARROW_UP ? (length + index - 5) % length : index;\n        gallery.current.children[nextIndex].focus();\n      }\n\n      event.preventDefault();\n    } else if (keyBindings.includes(event.key.toLowerCase()) && !isWritableElement(event.target)) {\n      var _index = keyBindings.indexOf(event.key.toLowerCase());\n\n      gallery.current.children[_index].focus();\n\n      event.preventDefault();\n    } else if (event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) {\n      event.preventDefault();\n      onClose();\n    }\n\n    event.nativeEvent.stopImmediatePropagation();\n  };\n\n  return React.createElement(\"div\", {\n    className: \"color-picker\",\n    role: \"dialog\",\n    \"aria-modal\": \"true\",\n    \"aria-label\": t(\"labels.colorPicker\"),\n    onKeyDown: handleKeyDown,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"color-picker-triangle-shadow\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"color-picker-triangle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"color-picker-content\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"colors-gallery\",\n    ref: function ref(el) {\n      if (el) {\n        gallery.current = el;\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  }, colors.map(function (_color, i) {\n    return React.createElement(\"button\", {\n      className: \"color-picker-swatch\",\n      onClick: function onClick() {\n        _onChange(_color);\n      },\n      title: \"\".concat(_color, \" \\u2014 \").concat(keyBindings[i].toUpperCase()),\n      \"aria-label\": _color,\n      \"aria-keyshortcuts\": keyBindings[i],\n      style: {\n        backgroundColor: _color\n      },\n      key: _color,\n      ref: function ref(el) {\n        if (el && i === 0) {\n          firstItem.current = el;\n        }\n\n        if (el && _color === color) {\n          activeItem.current = el;\n        }\n      },\n      onFocus: function onFocus() {\n        _onChange(_color);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, _color === \"transparent\" ? React.createElement(\"div\", {\n      className: \"color-picker-transparent\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }) : undefined, React.createElement(\"span\", {\n      className: \"color-picker-keybinding\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, keyBindings[i]));\n  })), React.createElement(ColorInput, {\n    color: color,\n    label: label,\n    onChange: function onChange(color) {\n      _onChange(color);\n    },\n    ref: colorInput,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  })));\n};\n\nvar ColorInput = React.forwardRef(function (_ref2, ref) {\n  var color = _ref2.color,\n      _onChange2 = _ref2.onChange,\n      label = _ref2.label;\n  var colorRegex = /^([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8}|transparent)$/;\n\n  var _React$useState = React.useState(color),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      innerValue = _React$useState2[0],\n      setInnerValue = _React$useState2[1];\n\n  var inputRef = React.useRef(null);\n  React.useEffect(function () {\n    setInnerValue(color);\n  }, [color]);\n  React.useImperativeHandle(ref, function () {\n    return inputRef.current;\n  });\n  return React.createElement(\"div\", {\n    className: \"color-input-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"color-picker-hash\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, \"#\"), React.createElement(\"input\", {\n    spellCheck: false,\n    className: \"color-picker-input\",\n    \"aria-label\": label,\n    onChange: function onChange(event) {\n      var value = event.target.value.toLowerCase();\n\n      if (value.match(colorRegex)) {\n        _onChange2(value === \"transparent\" ? \"transparent\" : \"#\".concat(value));\n      }\n\n      setInnerValue(value);\n    },\n    value: (innerValue || \"\").replace(/^#/, \"\"),\n    onPaste: function onPaste(event) {\n      return _onChange2(event.clipboardData.getData(\"text\"));\n    },\n    onBlur: function onBlur() {\n      return setInnerValue(color);\n    },\n    ref: inputRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }));\n});\nexport function ColorPicker(_ref3) {\n  var type = _ref3.type,\n      color = _ref3.color,\n      _onChange3 = _ref3.onChange,\n      label = _ref3.label;\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      isActive = _React$useState4[0],\n      setActive = _React$useState4[1];\n\n  var pickerButton = React.useRef(null);\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"color-picker-control-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"color-picker-label-swatch\",\n    \"aria-label\": label,\n    style: color ? {\n      backgroundColor: color\n    } : undefined,\n    onClick: function onClick() {\n      return setActive(!isActive);\n    },\n    ref: pickerButton,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }), React.createElement(ColorInput, {\n    color: color,\n    label: label,\n    onChange: function onChange(color) {\n      _onChange3(color);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  })), React.createElement(React.Suspense, {\n    fallback: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245\n    },\n    __self: this\n  }, isActive ? React.createElement(Popover, {\n    onCloseRequest: function onCloseRequest() {\n      return setActive(false);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  }, React.createElement(Picker, {\n    colors: colors[type],\n    color: color || null,\n    onChange: function onChange(changedColor) {\n      _onChange3(changedColor);\n    },\n    onClose: function onClose() {\n      var _pickerButton$current;\n\n      setActive(false);\n      (_pickerButton$current = pickerButton.current) === null || _pickerButton$current === void 0 ? void 0 : _pickerButton$current.focus();\n    },\n    label: label,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248\n    },\n    __self: this\n  })) : null));\n} // https://yeun.github.io/open-color/\n\nvar colors = {\n  // Shade 0\n  canvasBackground: [\"#ffffff\", \"#f8f9fa\", \"#f1f3f5\", \"#fff5f5\", \"#fff0f6\", \"#f8f0fc\", \"#f3f0ff\", \"#edf2ff\", \"#e7f5ff\", \"#e3fafc\", \"#e6fcf5\", \"#ebfbee\", \"#f4fce3\", \"#fff9db\", \"#fff4e6\"],\n  // Shade 6\n  elementBackground: [\"transparent\", \"#ced4da\", \"#868e96\", \"#fa5252\", \"#e64980\", \"#be4bdb\", \"#7950f2\", \"#4c6ef5\", \"#228be6\", \"#15aabf\", \"#12b886\", \"#40c057\", \"#82c91e\", \"#fab005\", \"#fd7e14\"],\n  // Shade 9\n  elementStroke: [\"#000000\", \"#343a40\", \"#495057\", \"#c92a2a\", \"#a61e4d\", \"#862e9c\", \"#5f3dc4\", \"#364fc7\", \"#1864ab\", \"#0b7285\", \"#087f5b\", \"#2b8a3e\", \"#5c940d\", \"#e67700\", \"#d9480f\"]\n};","map":{"version":3,"sources":["/home/pro/Solutions/drawboard-light/src/components/ColorPicker.tsx"],"names":["React","Popover","KEYS","t","isWritableElement","keyBindings","flat","Picker","colors","color","onChange","onClose","label","firstItem","useRef","activeItem","gallery","colorInput","useEffect","current","focus","handleKeyDown","event","key","TAB","document","activeElement","shiftKey","preventDefault","ARROW_RIGHT","ARROW_LEFT","ARROW_UP","ARROW_DOWN","index","Array","prototype","indexOf","call","children","length","nextIndex","includes","toLowerCase","target","ESCAPE","ENTER","nativeEvent","stopImmediatePropagation","el","map","_color","i","toUpperCase","backgroundColor","undefined","ColorInput","forwardRef","ref","colorRegex","useState","innerValue","setInnerValue","inputRef","useImperativeHandle","value","match","replace","clipboardData","getData","ColorPicker","type","isActive","setActive","pickerButton","changedColor","canvasBackground","elementBackground","elementStroke"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Popover } from \"./Popover\";\n\nimport \"./ColorPicker.css\";\nimport { KEYS } from \"../keys\";\nimport { t } from \"../i18n\";\nimport { isWritableElement } from \"../utils\";\n\n// This is a narrow reimplementation of the awesome react-color Twitter component\n// https://github.com/casesandberg/react-color/blob/master/src/components/twitter/Twitter.js\n\n// Unfortunately, we can't detect keyboard layout in the browser. So this will\n// only work well for QWERTY but not AZERTY or others...\nconst keyBindings = [\n  [\"1\", \"2\", \"3\", \"4\", \"5\"],\n  [\"q\", \"w\", \"e\", \"r\", \"t\"],\n  [\"a\", \"s\", \"d\", \"f\", \"g\"],\n].flat();\n\nconst Picker = function({\n  colors,\n  color,\n  onChange,\n  onClose,\n  label,\n}: {\n  colors: string[];\n  color: string | null;\n  onChange: (color: string) => void;\n  onClose: () => void;\n  label: string;\n}) {\n  const firstItem = React.useRef<HTMLButtonElement>();\n  const activeItem = React.useRef<HTMLButtonElement>();\n  const gallery = React.useRef<HTMLDivElement>();\n  const colorInput = React.useRef<HTMLInputElement>();\n\n  React.useEffect(() => {\n    // After the component is first mounted\n    // focus on first input\n    if (activeItem.current) {\n      activeItem.current.focus();\n    } else if (colorInput.current) {\n      colorInput.current.focus();\n    }\n  }, []);\n\n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (event.key === KEYS.TAB) {\n      const { activeElement } = document;\n      if (event.shiftKey) {\n        if (activeElement === firstItem.current) {\n          colorInput.current?.focus();\n          event.preventDefault();\n        }\n      } else {\n        if (activeElement === colorInput.current) {\n          firstItem.current?.focus();\n          event.preventDefault();\n        }\n      }\n    } else if (\n      event.key === KEYS.ARROW_RIGHT ||\n      event.key === KEYS.ARROW_LEFT ||\n      event.key === KEYS.ARROW_UP ||\n      event.key === KEYS.ARROW_DOWN\n    ) {\n      const { activeElement } = document;\n      const index = Array.prototype.indexOf.call(\n        gallery!.current!.children,\n        activeElement,\n      );\n      if (index !== -1) {\n        const length = gallery!.current!.children.length;\n        const nextIndex =\n          event.key === KEYS.ARROW_RIGHT\n            ? (index + 1) % length\n            : event.key === KEYS.ARROW_LEFT\n            ? (length + index - 1) % length\n            : event.key === KEYS.ARROW_DOWN\n            ? (index + 5) % length\n            : event.key === KEYS.ARROW_UP\n            ? (length + index - 5) % length\n            : index;\n        (gallery!.current!.children![nextIndex] as any).focus();\n      }\n      event.preventDefault();\n    } else if (\n      keyBindings.includes(event.key.toLowerCase()) &&\n      !isWritableElement(event.target)\n    ) {\n      const index = keyBindings.indexOf(event.key.toLowerCase());\n      (gallery!.current!.children![index] as any).focus();\n      event.preventDefault();\n    } else if (event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) {\n      event.preventDefault();\n      onClose();\n    }\n    event.nativeEvent.stopImmediatePropagation();\n  };\n\n  return (\n    <div\n      className=\"color-picker\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label={t(\"labels.colorPicker\")}\n      onKeyDown={handleKeyDown}\n    >\n      <div className=\"color-picker-triangle-shadow\"></div>\n      <div className=\"color-picker-triangle\"></div>\n      <div className=\"color-picker-content\">\n        <div\n          className=\"colors-gallery\"\n          ref={el => {\n            if (el) {\n              gallery.current = el;\n            }\n          }}\n        >\n          {colors.map((_color, i) => (\n            <button\n              className=\"color-picker-swatch\"\n              onClick={() => {\n                onChange(_color);\n              }}\n              title={`${_color} â€” ${keyBindings[i].toUpperCase()}`}\n              aria-label={_color}\n              aria-keyshortcuts={keyBindings[i]}\n              style={{ backgroundColor: _color }}\n              key={_color}\n              ref={el => {\n                if (el && i === 0) {\n                  firstItem.current = el;\n                }\n                if (el && _color === color) {\n                  activeItem.current = el;\n                }\n              }}\n              onFocus={() => {\n                onChange(_color);\n              }}\n            >\n              {_color === \"transparent\" ? (\n                <div className=\"color-picker-transparent\"></div>\n              ) : (\n                undefined\n              )}\n              <span className=\"color-picker-keybinding\">{keyBindings[i]}</span>\n            </button>\n          ))}\n        </div>\n        <ColorInput\n          color={color}\n          label={label}\n          onChange={color => {\n            onChange(color);\n          }}\n          ref={colorInput}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst ColorInput = React.forwardRef(\n  (\n    {\n      color,\n      onChange,\n      label,\n    }: {\n      color: string | null;\n      onChange: (color: string) => void;\n      label: string;\n    },\n    ref,\n  ) => {\n    const colorRegex = /^([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8}|transparent)$/;\n    const [innerValue, setInnerValue] = React.useState(color);\n    const inputRef = React.useRef(null);\n\n    React.useEffect(() => {\n      setInnerValue(color);\n    }, [color]);\n\n    React.useImperativeHandle(ref, () => inputRef.current);\n\n    return (\n      <div className=\"color-input-container\">\n        <div className=\"color-picker-hash\">#</div>\n        <input\n          spellCheck={false}\n          className=\"color-picker-input\"\n          aria-label={label}\n          onChange={event => {\n            const value = event.target.value.toLowerCase();\n            if (value.match(colorRegex)) {\n              onChange(value === \"transparent\" ? \"transparent\" : `#${value}`);\n            }\n            setInnerValue(value);\n          }}\n          value={(innerValue || \"\").replace(/^#/, \"\")}\n          onPaste={event => onChange(event.clipboardData.getData(\"text\"))}\n          onBlur={() => setInnerValue(color)}\n          ref={inputRef}\n        />\n      </div>\n    );\n  },\n);\n\nexport function ColorPicker({\n  type,\n  color,\n  onChange,\n  label,\n}: {\n  type: \"canvasBackground\" | \"elementBackground\" | \"elementStroke\";\n  color: string | null;\n  onChange: (color: string) => void;\n  label: string;\n}) {\n  const [isActive, setActive] = React.useState(false);\n  const pickerButton = React.useRef<HTMLButtonElement>(null);\n\n  return (\n    <div>\n      <div className=\"color-picker-control-container\">\n        <button\n          className=\"color-picker-label-swatch\"\n          aria-label={label}\n          style={color ? { backgroundColor: color } : undefined}\n          onClick={() => setActive(!isActive)}\n          ref={pickerButton}\n        />\n        <ColorInput\n          color={color}\n          label={label}\n          onChange={color => {\n            onChange(color);\n          }}\n        />\n      </div>\n      <React.Suspense fallback=\"\">\n        {isActive ? (\n          <Popover onCloseRequest={() => setActive(false)}>\n            <Picker\n              colors={colors[type]}\n              color={color || null}\n              onChange={changedColor => {\n                onChange(changedColor);\n              }}\n              onClose={() => {\n                setActive(false);\n                pickerButton.current?.focus();\n              }}\n              label={label}\n            />\n          </Popover>\n        ) : null}\n      </React.Suspense>\n    </div>\n  );\n}\n\n// https://yeun.github.io/open-color/\nconst colors = {\n  // Shade 0\n  canvasBackground: [\n    \"#ffffff\",\n    \"#f8f9fa\",\n    \"#f1f3f5\",\n    \"#fff5f5\",\n    \"#fff0f6\",\n    \"#f8f0fc\",\n    \"#f3f0ff\",\n    \"#edf2ff\",\n    \"#e7f5ff\",\n    \"#e3fafc\",\n    \"#e6fcf5\",\n    \"#ebfbee\",\n    \"#f4fce3\",\n    \"#fff9db\",\n    \"#fff4e6\",\n  ],\n  // Shade 6\n  elementBackground: [\n    \"transparent\",\n    \"#ced4da\",\n    \"#868e96\",\n    \"#fa5252\",\n    \"#e64980\",\n    \"#be4bdb\",\n    \"#7950f2\",\n    \"#4c6ef5\",\n    \"#228be6\",\n    \"#15aabf\",\n    \"#12b886\",\n    \"#40c057\",\n    \"#82c91e\",\n    \"#fab005\",\n    \"#fd7e14\",\n  ],\n  // Shade 9\n  elementStroke: [\n    \"#000000\",\n    \"#343a40\",\n    \"#495057\",\n    \"#c92a2a\",\n    \"#a61e4d\",\n    \"#862e9c\",\n    \"#5f3dc4\",\n    \"#364fc7\",\n    \"#1864ab\",\n    \"#0b7285\",\n    \"#087f5b\",\n    \"#2b8a3e\",\n    \"#5c940d\",\n    \"#e67700\",\n    \"#d9480f\",\n  ],\n};\n"]},"metadata":{},"sourceType":"module"}